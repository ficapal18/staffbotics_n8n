# Dockerfile
#
# Goal:
# - Start from official n8n image
# - Add small utilities used by init script (curl + psql client)
# - Copy init scripts + your workflow JSON into the image so paths always exist
#
# This fixes your current error:
#   "/bin/sh: /data/scripts/n8n_init.sh: not found"
#
# Because now the script is guaranteed to be inside the image.

FROM n8nio/n8n:latest

USER root

# Install curl + CA certs + Postgres client (psql/pg_isready)
RUN (command -v apk >/dev/null 2>&1 && apk add --no-cache curl ca-certificates postgresql-client) || \
    (command -v apt-get >/dev/null 2>&1 && apt-get update && apt-get install -y curl ca-certificates postgresql-client && rm -rf /var/lib/apt/lists/*) || \
    (echo "No supported package manager found" && exit 1)

# Copy scripts + workflow into the image (portable, no bind-mount required)
# Your repo should contain:
#   ./scripts/n8n_init.sh
#   ./workflows/staffbotics.json
COPY scripts/ /data/scripts/
COPY workflows/ /data/workflows/

# Make sure scripts are executable inside the image
RUN chmod -R a+rx /data/scripts

USER node
